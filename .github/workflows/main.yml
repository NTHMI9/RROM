name: VH-OS
on: 
  workflow_dispatch:
  issues:
    types:
      - opened
      #- reopened
permissions: write-all
jobs:
  build:
    name: 'Xem quá trình'
    if: github.repository == 'chamchamfy/RROM' && github.ref == 'refs/heads/main'
    runs-on: ubuntu-22.04
    steps:
      - name: 'Tắt Issues'
        uses: actions/stale@v8
        with:
          only-labels: "build"
          stale-issue-label: "Wait"
          stale-issue-message: "Đang trong quá trình xây dựng, vui lòng chờ...<br/><br/>Sau khi xong link sẽ được gửi vào bài viết này."
          days-before-issue-stale: 0
          days-before-stale: 0
          days-before-issue-close: 0
          days-before-close: 0
          repo-token: ${{ secrets.GITHUB_TOKEN }}
      - name: Nạp dữ liệu
        uses: actions/checkout@v3
      - name: 'Tải về'
        run: |
          # Taive          
          bash .github/Taive.sh
      - name: 'Xem build ROM'
        run: |
          # CC          
          bash .github/Chay.sh
      - name: Upload
        run: |
          # kakathic
          TOME="$GITHUB_WORKSPACE"
          cd $TOME/.github/libpy/Flash2in1
          echo $TOME/$NEMEROM
          zip -qr $TOME/$NEMEROM *
          url2="$(curl -s https://api.gofile.io/getServer | jq -r .data.server)"
          eval "curl -F 'file=@$TOME/$NEMEROM' 'https://$url2.gofile.io/uploadFile' > $TOME/1.json"
          echo
          echo "LINKROM=$(cat $TOME/1.json | jq -r .data.downloadPage)" | tee -a $GITHUB_ENV
          echo "MD5=$(cat $TOME/1.json | jq -r .data.md5)" | tee -a $GITHUB_ENV
          echo "NAMER=$(cat $TOME/1.json | jq -r .data.fileName)" | tee -a $GITHUB_ENV
      - name: Dán Thẻ
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'add-labels'
          labels: 'Hoàn thành'
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: 2
      - name: Dán Link
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'create-comment'
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: 2
          body: |
            NAME: ${{ env.NAMER }}<br/><br/>LINK DOWNLOAD: ${{ env.LINKROM }}<br/><br/>MD5: ${{ env.MD5 }}   
          
